<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>搭建Artifactory集群 | 源代码</title>
  <meta name="google-site-verification" content="L7cNt2_aJoaEPcMgfBInN5d_XUuOW5DCDZBGzYp7rbE" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="baidu-site-verification" content="gvGfP4Z8md" />
  <meta name="description" content="制品仓库系统有很多，例如Artifactory、Archiva、Sonatype Nexus、Eclipse Package Drone，其中Artifactory拥有很多强大的企业级特性和人性化的用户接口，拥有众多客户群。很多大型的公司都在使用它，通过以下的Google趋势图可以看出，它越来越受青睐。功能对比在此：Binary Repository Manager Feature Matrix">
<meta property="og:type" content="article">
<meta property="og:title" content="搭建Artifactory集群">
<meta property="og:url" content="http://wenhao.github.io/2016/05/05/搭建Artifactory集群/index.html">
<meta property="og:site_name" content="源代码">
<meta property="og:description" content="制品仓库系统有很多，例如Artifactory、Archiva、Sonatype Nexus、Eclipse Package Drone，其中Artifactory拥有很多强大的企业级特性和人性化的用户接口，拥有众多客户群。很多大型的公司都在使用它，通过以下的Google趋势图可以看出，它越来越受青睐。功能对比在此：Binary Repository Manager Feature Matrix">
<meta property="og:image" content="http://wenhao.github.io/img/binary-repository-trends.png">
<meta property="og:image" content="http://wenhao.github.io/img/artifactory-architecture.png">
<meta property="og:image" content="http://wenhao.github.io/img/artifactory-eco-system.png">
<meta property="og:updated_time" content="2016-05-09T13:16:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="搭建Artifactory集群">
<meta name="twitter:description" content="制品仓库系统有很多，例如Artifactory、Archiva、Sonatype Nexus、Eclipse Package Drone，其中Artifactory拥有很多强大的企业级特性和人性化的用户接口，拥有众多客户群。很多大型的公司都在使用它，通过以下的Google趋势图可以看出，它越来越受青睐。功能对比在此：Binary Repository Manager Feature Matrix">
  
  
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c0ca8b0ebc2d1d2c71c7dc0611edd075";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  <script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
  <script type="text/javascript" src="http://tajs.qq.com/stats?sId=47749856" charset="UTF-8"></script>
				
</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo"></i><span class="site-title">源代码</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://wenhao.github.io"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">首页</a></td>
      
        <td><a class="main-nav-link" href="/archives">归档</a></td>
      
        <td><a class="main-nav-link" href="/categories">分类</a></td>
      
        <td><a class="main-nav-link" href="/tags">标签</a></td>
      
        <td><a class="main-nav-link" href="/about">关于</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://wenhao.github.io"></form>
      </td>
      </tr>
    </table>
  </div>
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="/css/images/avatar.png">
      <h2 id="name">文浩</h2>
      <h3 id="title">技术经理</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Chengdu, China</span>
      <a id="follow" href="https://github.com/wenhao/" target="_blank">关注我</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        10
        <span>文章</span>
      </div>
      <div class="article-info-block">
        14
        <span>标签</span>
      </div>
    </div>
    
    
        <div class="contact-info">
          <img class="qrcode" src="/css/images/webchat.JPG">
        </div>
        
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="http://github.com/wenhao" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="/#" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/#" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
        
          <td><a href="/#" target="_blank" title="dribbble"><i class="fa fa-dribbble"></i></a></td>
        
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    
  </div>
</aside>
      <section id="main"><article id="post-搭建Artifactory集群" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      搭建Artifactory集群
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2016/05/05/搭建Artifactory集群/">
    <time datetime="2016-05-05T14:51:19.000Z" itemprop="datePublished">2016年05月5日</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/devops/">devops</a>
  </div>

          
<div class="article-author"><i class="fa fa-user"></i>
  
  <a href="http://wenhao.github.io" title="文浩">文浩</a>
</div>
  

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <p>制品仓库系统有很多，例如<a href="https://www.jfrog.com/" target="_blank" rel="external">Artifactory</a>、<a href="http://archiva.apache.org/" target="_blank" rel="external">Archiva</a>、<a href="http://www.sonatype.org/nexus" target="_blank" rel="external">Sonatype Nexus</a>、<a href="https://eclipse.org/package-drone" target="_blank" rel="external">Eclipse Package Drone</a>，其中Artifactory拥有很多强大的企业级特性和人性化的用户接口，拥有众多客户群。很多大型的公司都在使用它，通过以下的Google趋势图可以看出，它越来越受青睐。功能对比在此：<a href="https://binary-repositories-comparison.github.io/" target="_blank" rel="external">Binary Repository Manager Feature Matrix</a></p>
<p><img src="/img/binary-repository-trends.png" alt="Google趋势图"></p>
<p>本文将尝试在阿里云上搭建Artifactory集群。</p>
<h3 id="Artifactory许可证">Artifactory许可证</h3><p>官方正版license，3个 License 25900美元(16.7万人民币)一年，贵的离谱。本文以实验学习为主使用最新破解版4.7.4，破解也非常容易就不赘述了。商业用途，请使用正版。</p>
<h3 id="所需硬件">所需硬件</h3><p>Artifactory集群需要以下硬件设备：</p>
<ol>
<li>支持粘性会话的均衡负载(HAProxy/Nginx等)。</li>
<li>NFS共享文件夹。</li>
<li>数据库(MySQL等)。</li>
</ol>
<a id="more"></a>
<h3 id="搭建架构图">搭建架构图</h3><p><img src="/img/artifactory-architecture.png" alt="Artifactory集群"></p>
<h3 id="网络">网络</h3><p>集群中所有的节点<strong>最好</strong>处于同一局域网内，节点之间使用固定端口传输数据。</p>
<h3 id="服务器">服务器</h3><p>本文使用阿里云ECS服务器，申请三台阿里云ECS服务器分别取名artifactory-master,artifactory-slave,artifactory-nfs。</p>
<h3 id="Artifactory节点配置">Artifactory节点配置</h3><p>artifactory会部署在artifactory-master和artifactory-slave上，需要安装所需的软件。</p>
<ol>
<li><a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/" target="_blank" rel="external">生成ssh key</a>并配置authorized_keys方便服务管理。</li>
<li><p>安装JDK 8。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get install software-properties-common</span><br><span class="line">add-apt-repository ppa:webupd8team/java</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install oracle-java8-installer</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑.bashrc文件<code>vi ~/.bashrc</code>在文件尾加入以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="operator">-f</span> ~/.bash_env ]; <span class="keyword">then</span></span><br><span class="line">    . ~/.bash_env</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建<code>.bash_env</code>文件<code>touch ~/.bash_env</code>并添加JAVA_HOME环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="number">8</span>-oracle</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>上传artifactory-pro-4.7.4.zip到artifactory-master和artifactory-slave服务器<code>/opt</code>目录并解压，并生成两个不同的<code>artifactory.lic</code>许可证，分别放在/opt/jfrog/artifactory-pro-4.7.4/etc目录下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp artifactory-pro-<span class="number">4.7</span>.<span class="number">4</span>.zip root@&lt;ip&gt;:/opt</span><br></pre></td></tr></table></figure>
</li>
<li><p>分别在artifactory两个节点设置artifactory环境变量，编辑<code>.bash_env</code>文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ARTIFACTORY_HOME=/opt/jfrog/artifactory-pro-<span class="number">4.7</span>.<span class="number">4</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="number">8</span>-oracle</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装artifactory as service。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sh installService.sh</span><br><span class="line"></span><br><span class="line">passwd artifactory &lt;new password&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="NFS配置">NFS配置</h3><p>NFS配置需要在artifactory-nfs上安装NFS服务端，需要在artifactory-master和artifactory-salve上安装NFS客户端。</p>
<ol>
<li><p>在artifactory-nfs服务器上安装nfs-kernel-server。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-kernel-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>在/etc/exports文件里增加一行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/artifactory/cluster-home *(rw,sync,no_root_squash,no_subtree_check)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在artifactory-master和artifactory-salve分别安装NFS客户端。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common portmap</span><br></pre></td></tr></table></figure>
</li>
<li><p>在artifactory-master和artifactory-salve分别创建NFS待挂载目录/artifactory/cluster-home。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /artifactory/cluster-home</span><br><span class="line">mount &lt;artifactory-nfs<span class="string">' IP&gt;:/artifactory/cluster-home /artifactory/cluster-home</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将NFS目录分配权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   chown -R artifactory:artifactory /artifactory/cluster-home</span><br><span class="line">   ```   </span><br><span class="line"></span><br><span class="line"><span class="comment">###安装MySQL</span></span><br><span class="line"></span><br><span class="line">在artifactory-nfs上安装MySQL。</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 安装MySQL。</span><br><span class="line"></span><br><span class="line">   ```bash</span><br><span class="line">   apt-get install mysql-server mysql-client</span><br><span class="line"></span><br><span class="line">   mysql&gt;</span><br><span class="line">   CREATE DATABASE artdb CHARACTER SET utf8 COLLATE utf8_bin;</span><br><span class="line">   CREATE USER artifactory IDENTIFIED BY <span class="string">'password'</span>;</span><br><span class="line">   GRANT ALL PRIVILEGES ON *.* TO <span class="string">'artifactory'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'password'</span> WITH GRANT OPTION;</span><br><span class="line">   FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="https://www.jfrog.com/confluence/display/RTF/MySQL" target="_blank" rel="external">MySQL性能优化</a>。</p>
</li>
<li>允许MySQL远程访问。修改云主机上的/etc/mysql/my.cnf 文件，注释掉 bind_address=127.0.0.1就可以了。</li>
</ol>
<h3 id="配置artifactory-master">配置artifactory-master</h3><ol>
<li><p>在<code>/artifactory/cluster-home</code>下创建一下目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ha-etc</span><br><span class="line">mkdir ha-data</span><br><span class="line">mkdir ha-backup</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>./ha-etc</code>下创建文件<code>cluster.properties</code>，内容为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##随机生成的token，保证唯一就行</span></span><br><span class="line">security.token=<span class="number">4</span>n4tpxip7spQQu2pKf3811S2W7GY46Yb</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>./ha-etc</code>下创建文件<code>storage.properties</code>，内容为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>=mysql</span><br><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://&lt;artifactory-nfs<span class="string">' IP&gt;:3306/artdb?characterEncoding=UTF-8&amp;elideSetAutoCommits=true</span><br><span class="line">username=artifactory</span><br><span class="line">password=password</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>复制<code>artifactory.system.properties</code>和<code>mimetypes.xml</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /opt/jfrog/artifactory-pro-<span class="number">4.7</span>.<span class="number">4</span>/etc/artifactory.system.properties /artifactory/cluster-home/ha-etc</span><br><span class="line">mv /opt/jfrog/artifactory-pro-<span class="number">4.7</span>.<span class="number">4</span>/etc/mimetypes.xml /artifactory/cluster-home/ha-etc</span><br></pre></td></tr></table></figure>
</li>
<li><p>在/opt/artifactory-pro-4.7.4/etc目录下创建<code>ha-node.properties</code>文件，内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node.id=art1</span><br><span class="line">cluster.home=/artifactory/cluster-home</span><br><span class="line">context.url=http://&lt;artifactory-master<span class="string">'s IP&gt;:8081/artifactory</span><br><span class="line">membership.port=10001</span><br><span class="line">primary=true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>.bash_env</code>文件添加$CLUSTER_HOME环境变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ARTIFACTORY_HOME=/opt/jfrog/artifactory-pro-<span class="number">4.7</span>.<span class="number">4</span></span><br><span class="line"><span class="built_in">export</span> CLUSTER_HOME=/artifactory/cluster-home</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="number">8</span>-oracle</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="配置artifactory-slave">配置artifactory-slave</h3><p>注意：对于每个artifactory集群节点使用的artifactory.lic是不一样的，否者将会报错。</p>
<ol>
<li><p>在/opt/jfrog/artifactory-pro-4.7.4/etc目录下创建<code>ha-node.properties</code>文件，内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node.id=art2</span><br><span class="line">cluster.home=/artifactory/cluster-home</span><br><span class="line">context.url=http://&lt;artifactory-slave<span class="string">'s IP&gt;:8081/artifactory</span><br><span class="line">membership.port=10001</span><br><span class="line">primary=false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在.bash_env文件添加<code>$CLUSTER_HOME</code>环境变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ARTIFACTORY_HOME=/opt/jfrog/artifactory-pro-<span class="number">4.7</span>.<span class="number">4</span></span><br><span class="line"><span class="built_in">export</span> CLUSTER_HOME=/artifactory/cluster-home</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="number">8</span>-oracle</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="安装Nginx负载均衡">安装Nginx负载均衡</h3><p>Nginx也支持粘性会话如使用<code>ip_hash</code>等，但是最好的方案是借助第三份中间件例如Redis来存储session，使用<a href="https://github.com/jcoleman/tomcat-redis-session-manager" target="_blank" rel="external">Nginx+Tomcat+Redis</a>组合。在此我使用最简单的<code>ip_hash</code>方法。Nginx的default文件配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##nginx.conf</span></span><br><span class="line"><span class="title">user</span> www-data;</span><br><span class="line"></span><br><span class="line"><span class="title">worker_processes</span> <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="title">error_log</span> /var/log/nginx/error.log <span class="built_in">crit</span>;</span><br><span class="line"></span><br><span class="line"><span class="title">pid</span> /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="title">events</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="title">use</span> <span class="built_in">epoll</span>;</span><br><span class="line">  <span class="title">worker_connections</span> <span class="number">8192</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">http</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="title">include</span> /etc/nginx/mime.types;</span><br><span class="line">  <span class="title">default_type</span> application/octet-stream;</span><br><span class="line"></span><br><span class="line">  <span class="title">charset</span> utf-<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">server_names_hash_bucket_size</span> <span class="number">128</span>;</span><br><span class="line">  <span class="title">client_header_buffer_size</span> <span class="number">32k</span>;</span><br><span class="line">  <span class="title">large_client_header_buffers</span> <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">keepalive_timeout</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">sendfile</span> <span class="built_in">on</span>;</span><br><span class="line">  <span class="title">tcp_nopush</span> <span class="built_in">on</span>;</span><br><span class="line">  <span class="title">tcp_nodelay</span> <span class="built_in">on</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># gzip压缩功能设置</span></span><br><span class="line">  <span class="title">gzip</span> <span class="built_in">on</span>;</span><br><span class="line">  <span class="title">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">  <span class="title">gzip_buffers</span> <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line">  <span class="title">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">  <span class="title">gzip_comp_level</span> <span class="number">2</span>;</span><br><span class="line">  <span class="title">gzip_types</span> text/plain application/json application/xml application/x-javascript text/css text/xml text/javascript;</span><br><span class="line">  <span class="title">gzip_vary</span> <span class="built_in">on</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#允许客户端请求的最大的单个文件字节数</span></span><br><span class="line">  <span class="title">client_max_body_size</span> <span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#缓冲区代理缓冲用户端请求的最大字节数</span></span><br><span class="line">  <span class="title">client_body_buffer_size</span> <span class="number">128k</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#跟后端服务器连接的超时时间_发起握手等候响应超时时间</span></span><br><span class="line">  <span class="title">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#连接成功后_等候后端服务器响应时间_其实已经进入后端的排队之中等候处理</span></span><br><span class="line">  <span class="title">proxy_read_timeout</span> <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#后端服务器数据回传时间_就是在规定时间之内后端服务器必须传完所有的数据</span></span><br><span class="line">  <span class="title">proxy_send_timeout</span> <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#代理请求缓存区_这个缓存区间会保存用户的头信息以供Nginx经行规则处理_一般只要能保存下头信息即可</span></span><br><span class="line">  <span class="title">proxy_buffer_size</span> <span class="number">16k</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#Nginx保存单个用的几个Buffer及最大用多大空间</span></span><br><span class="line">  <span class="title">proxy_buffers</span> <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#如果系统很忙的时候可以申请最大的proxy_buffers</span></span><br><span class="line">  <span class="title">proxy_busy_buffers_size</span> <span class="number">64k</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#proxy缓存临时文件的大小</span></span><br><span class="line">  <span class="title">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">include</span> /etc/nginx/conf.d/<span class="regexp">*.conf</span>;</span><br><span class="line">  <span class="title">include</span> /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##default</span></span><br><span class="line">upstream artifactory &#123;</span><br><span class="line">    ip_<span class="built_in">hash</span>;</span><br><span class="line">    server &lt;ip&gt;:&lt;port&gt;;</span><br><span class="line">    server &lt;ip&gt;:&lt;port&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">truelisten <span class="number">80</span> default_server;</span><br><span class="line">truelisten [::]:<span class="number">80</span> default_server ipv6only=on;</span><br><span class="line"></span><br><span class="line">trueroot /usr/share/nginx/html;</span><br><span class="line">trueindex index.html index.htm;</span><br><span class="line"></span><br><span class="line">true<span class="comment"># Make site accessible from http://localhost/</span></span><br><span class="line">trueserver_name localhost;</span><br><span class="line"></span><br><span class="line">true<span class="keyword">if</span> (<span class="variable">$http_x_forwarded_proto</span> = <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$http_x_forwarded_proto</span>  <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rewrite ^/$ /artifactory/webapp/ redirect;</span><br><span class="line">    rewrite ^/artifactory/?(/webapp)?$ /artifactory/webapp/ redirect;</span><br><span class="line"></span><br><span class="line">truelocation / &#123;</span><br><span class="line">truetrue<span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">truetrue<span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line">truetruetry_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">truetrue<span class="comment"># Uncomment to enable naxsi on this location</span></span><br><span class="line">truetrue<span class="comment"># include /etc/nginx/naxsi.rules</span></span><br><span class="line">true&#125;</span><br><span class="line"></span><br><span class="line">   location /artifactory &#123;</span><br><span class="line">       proxy_<span class="built_in">read</span>_timeout  <span class="number">900</span>;</span><br><span class="line">       proxy_pass_header   Server;</span><br><span class="line">       proxy_cookie_path ~*^/.* /;</span><br><span class="line">       proxy_pass         http://artifactory/artifactory/;</span><br><span class="line">       proxy_<span class="built_in">set</span>_header   X-Artifactory-Override-Base-Url <span class="variable">$http_x_forwarded_proto</span>://<span class="variable">$host</span>:<span class="variable">$server_port</span>/artifactory;</span><br><span class="line">       proxy_<span class="built_in">set</span>_header    X-Forwarded-Port  <span class="variable">$server_port</span>;</span><br><span class="line">       proxy_<span class="built_in">set</span>_header    X-Forwarded-Proto <span class="variable">$http_x_forwarded_proto</span>;</span><br><span class="line">       proxy_<span class="built_in">set</span>_header    Host              <span class="variable">$http_host</span>;</span><br><span class="line">       proxy_<span class="built_in">set</span>_header    X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="启动">启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - artifactory</span><br><span class="line">service artifactory start</span><br></pre></td></tr></table></figure>
<h3 id="仓库之间复制">仓库之间复制</h3><p>Artifactory允许支持不同地区不同项目之间artifactory实例复制。带来的好处有以下几点：</p>
<ol>
<li>不同地区的开发团队可以使用相同artifacts。</li>
<li>构建的产出artifacts能够及时共享。</li>
<li>缓解远程网络连接不稳定性。</li>
<li>访问远程其他artifactory仓库。</li>
</ol>
<h4 id="Push方式">Push方式</h4><p>用于本地仓库，上传到某个artifactory实例的某个本地仓库能够同步到其他远程artifactory仓库里面。</p>
<h4 id="Pull方式">Pull方式</h4><p>用于远程仓库，将远程artifactory仓库同步到本地artifactory某个仓库。</p>
<h3 id="安装JFrog_Mission_Control">安装JFrog Mission Control</h3><p>服务器有限，在artifactory-master上安装Mission Control。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://akamai.bintray.com/<span class="number">84</span>/<span class="number">842469</span>ab2f8d53dcd01e99c1f96b39b7580571a20096f741446e5c789ff2bca5?__gda__=exp=<span class="number">1462285257</span>~hmac=<span class="number">76</span>ab0b04df1b8b374bd539b83e246f8fe00ad8be57d7d7e47138b9ffb1b13a78&amp;response-content-disposition=attachment%<span class="number">3</span>Bfilename%<span class="number">3</span>D%<span class="number">22</span>jfrog-mission-control-<span class="number">1.1</span>.deb%<span class="number">22</span>&amp;response-content-type=application%<span class="number">2</span>Fx-debian-package</span><br><span class="line"></span><br><span class="line">apt-get install net-tools</span><br><span class="line"></span><br><span class="line">dpkg -i jfrog-mission-control-<span class="number">1.1</span>.deb</span><br></pre></td></tr></table></figure>
<h3 id="安装Jenkins">安装Jenkins</h3><p>在artifactory-slave上安装Jenkins</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O - https://jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -</span><br><span class="line">sudo sh -c <span class="string">'echo deb http://pkg.jenkins-ci.org/debian binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install jenkins</span><br></pre></td></tr></table></figure>
<h3 id="安装Packer">安装Packer</h3><p>安装jenkins packer plugin</p>
<h3 id="安装docker">安装docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install docker.io</span><br></pre></td></tr></table></figure>
<p>把jenkins用户加入到docker的group里面。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpasswd <span class="operator">-a</span> jenkins docker</span><br></pre></td></tr></table></figure>
<h3 id="设置Artifactory的docker_repository">设置Artifactory的docker repository</h3><h4 id="生成ssl">生成ssl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apt-get install openssl</span><br><span class="line"></span><br><span class="line">mkdir /etc/nginx/ssl</span><br><span class="line"></span><br><span class="line">openssl genrsa -out <span class="string">"/etc/nginx/ssl/artifactory.key"</span> <span class="number">2048</span></span><br><span class="line"></span><br><span class="line">openssl req -new -key <span class="string">"/etc/nginx/ssl/artifactory.key"</span> -out <span class="string">"/etc/nginx/ssl/artifactory.csr"</span></span><br><span class="line"></span><br><span class="line">openssl x509 -req -days <span class="number">365</span> -in <span class="string">"/etc/nginx/ssl/artifactory.csr"</span> -signkey <span class="string">"/etc/nginx/ssl/artifactory.key"</span> -out <span class="string">"/etc/nginx/ssl/artifactory.crt"</span></span><br></pre></td></tr></table></figure>
<h4 id="配置Nginx">配置Nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">upstream artifactory &#123;</span><br><span class="line">    ip_<span class="built_in">hash</span>;</span><br><span class="line">    server &lt;IP&gt;:&lt;PORT&gt;;</span><br><span class="line">    server &lt;IP&gt;:&lt;PORT&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">    server_name &lt;IP&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_x_forwarded_proto</span> = <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$http_x_forwarded_proto</span>  <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rewrite ^/$ /artifactory/webapp/ redirect;</span><br><span class="line">    rewrite ^/artifactory/?(/webapp)?$ /artifactory/webapp/ redirect;</span><br><span class="line"></span><br><span class="line">    location /artifactory/ &#123;</span><br><span class="line">        proxy_<span class="built_in">read</span>_timeout  <span class="number">900</span>;</span><br><span class="line">        proxy_pass_header   Server;</span><br><span class="line">        proxy_cookie_path ~*^/.* /;</span><br><span class="line">        proxy_pass         http://artifactory/artifactory/;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header   X-Artifactory-Override-Base-Url <span class="variable">$http_x_forwarded_proto</span>://<span class="variable">$host</span>:<span class="variable">$server_port</span>/artifactory;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    X-Forwarded-Port  <span class="variable">$server_port</span>;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    X-Forwarded-Proto <span class="variable">$http_x_forwarded_proto</span>;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    Host              <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">443</span> ssl;</span><br><span class="line"></span><br><span class="line">    server_name &lt;IP&gt;;</span><br><span class="line"></span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate     /etc/nginx/ssl/artifactory.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/artifactory.key;</span><br><span class="line">    ssl_session_cache shared:SSL:<span class="number">1</span>m;</span><br><span class="line">    ssl_prefer_server_ciphers   on;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_x_forwarded_proto</span> = <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$http_x_forwarded_proto</span>  <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rewrite ^/$ /artifactory/webapp/ redirect;</span><br><span class="line">    rewrite ^/artifactory/?(/webapp)?$ /artifactory/webapp/ redirect;</span><br><span class="line"></span><br><span class="line">    location /artifactory/ &#123;</span><br><span class="line">        proxy_<span class="built_in">read</span>_timeout  <span class="number">900</span>;</span><br><span class="line">        proxy_pass_header   Server;</span><br><span class="line">        proxy_cookie_path ~*^/.* /;</span><br><span class="line">        proxy_pass         http://artifactory/artifactory/;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header   X-Artifactory-Override-Base-Url <span class="variable">$http_x_forwarded_proto</span>://<span class="variable">$host</span>:<span class="variable">$server_port</span>/artifactory;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    X-Forwarded-Port  <span class="variable">$server_port</span>;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    X-Forwarded-Proto <span class="variable">$http_x_forwarded_proto</span>;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    Host              <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_<span class="built_in">set</span>_header    X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Artifactory生态链">Artifactory生态链</h3><p><img src="/img/artifactory-eco-system.png" alt="Artifactory生态链"></p>
<h3 id="Artifactory集群性能优化">Artifactory集群性能优化</h3><ol>
<li><a href="http://mkuthan.github.io/blog/2011/03/10/artifactory-performance-tuning/" target="_blank" rel="external">Artifactory Performance Tuning</a></li>
</ol>

      
    </div>

    
      <div id="article-toc">
	<div id="article-toc-title">文章目录<div>←</div></div>
	<div id="article-toc-content">
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Artifactory许可证"><span class="toc-number">1.</span> <span class="toc-text">Artifactory许可证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#所需硬件"><span class="toc-number">2.</span> <span class="toc-text">所需硬件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建架构图"><span class="toc-number">3.</span> <span class="toc-text">搭建架构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网络"><span class="toc-number">4.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器"><span class="toc-number">5.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Artifactory节点配置"><span class="toc-number">6.</span> <span class="toc-text">Artifactory节点配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS配置"><span class="toc-number">7.</span> <span class="toc-text">NFS配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置artifactory-master"><span class="toc-number">8.</span> <span class="toc-text">配置artifactory-master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置artifactory-slave"><span class="toc-number">9.</span> <span class="toc-text">配置artifactory-slave</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Nginx负载均衡"><span class="toc-number">10.</span> <span class="toc-text">安装Nginx负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动"><span class="toc-number">11.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#仓库之间复制"><span class="toc-number">12.</span> <span class="toc-text">仓库之间复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Push方式"><span class="toc-number">12.1.</span> <span class="toc-text">Push方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pull方式"><span class="toc-number">12.2.</span> <span class="toc-text">Pull方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装JFrog_Mission_Control"><span class="toc-number">13.</span> <span class="toc-text">安装JFrog Mission Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Jenkins"><span class="toc-number">14.</span> <span class="toc-text">安装Jenkins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Packer"><span class="toc-number">15.</span> <span class="toc-text">安装Packer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装docker"><span class="toc-number">16.</span> <span class="toc-text">安装docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置Artifactory的docker_repository"><span class="toc-number">17.</span> <span class="toc-text">设置Artifactory的docker repository</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#生成ssl"><span class="toc-number">17.1.</span> <span class="toc-text">生成ssl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置Nginx"><span class="toc-number">17.2.</span> <span class="toc-text">配置Nginx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Artifactory生态链"><span class="toc-number">18.</span> <span class="toc-text">Artifactory生态链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Artifactory集群性能优化"><span class="toc-number">19.</span> <span class="toc-text">Artifactory集群性能优化</span></a></li></ol>
	</div>
</div>
    
    <footer class="article-footer">
      <!-- 原分享代码 
      <a data-url="http://wenhao.github.io/2016/05/05/搭建Artifactory集群/" data-id="ciof7r3ym0008y1yz0tk87653" class="article-share-link">分享到</a>
      -->
      <!-- 百度分享 -->
      <div class="bdsharebuttonbox article-baidu-share-link">
          <a href="#" class="bds_more" data-cmd="more">分享到</a>
      </div>
      <script>
          window._bd_share_config = {
              "common": {
                  "bdSnsKey": {},
                  "bdText": "",
                  "bdMini": "2",
                  "bdPic": "",
                  "bdStyle": "0",
                  "bdSize": "16"
              },
              "share": {}
          };
          with(document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];
      </script>
      <!-- 百度分享结束 -->
      
        <!-- 评论
        <a href="http://wenhao.github.io/2016/05/05/搭建Artifactory集群/#ds-thread" class="article-comment-link">评论</a>
        -->
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/artifactory/">artifactory</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/">devops</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/05/20/Artifactory-Maven配置/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Artifactory Maven配置
        
      </div>
    </a>
  
  
    <a href="/2015/11/09/不要从单体应用开始/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">不要从单体应用开始</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
     <div id="ds-thread" class="ds-thread" data-thread-key="http://wenhao.github.io/2016/05/05/搭建Artifactory集群/" data-title="搭建Artifactory集群" data-url="http://wenhao.github.io/2016/05/05/搭建Artifactory集群/">
     </div>
  </section>
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/05/20/Artifactory-Maven配置/" class="thumbnail">
  
    <span style="background-image:url(/img/maven-local.png
)" alt="Artifactory Maven配置" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/devops/">devops</a></p>
              <p class="item-title"><a href="/2016/05/20/Artifactory-Maven配置/" class="title">Artifactory Maven配置</a></p>
              <p class="item-date"><time datetime="2016-05-20T04:13:24.000Z" itemprop="datePublished">2016年05月20日</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2016/05/05/搭建Artifactory集群/" class="thumbnail">
  
    <span style="background-image:url(/img/binary-repository-trends.png
)" alt="搭建Artifactory集群" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/devops/">devops</a></p>
              <p class="item-title"><a href="/2016/05/05/搭建Artifactory集群/" class="title">搭建Artifactory集群</a></p>
              <p class="item-date"><time datetime="2016-05-05T14:51:19.000Z" itemprop="datePublished">2016年05月5日</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/11/09/不要从单体应用开始/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/翻译/">翻译</a></p>
              <p class="item-title"><a href="/2015/11/09/不要从单体应用开始/" class="title">不要从单体应用开始</a></p>
              <p class="item-date"><time datetime="2015-11-09T14:18:15.000Z" itemprop="datePublished">2015年11月9日</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/11/02/REST-API版本控制/" class="thumbnail">
  
    <span style="background-image:url(/img/rest-api.png
)" alt="REST API版本控制" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/restful/">restful</a></p>
              <p class="item-title"><a href="/2015/11/02/REST-API版本控制/" class="title">REST API版本控制</a></p>
              <p class="item-date"><time datetime="2015-11-02T07:21:59.000Z" itemprop="datePublished">2015年11月2日</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/10/21/基于GeoHash+Redis实现LBS附近地点搜索/" class="thumbnail">
  
    <span style="background-image:url(/img/geohash.png
)" alt="基于GeoHash+Redis实现LBS附近地点搜索" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/geohash/">geohash</a></p>
              <p class="item-title"><a href="/2015/10/21/基于GeoHash+Redis实现LBS附近地点搜索/" class="title">基于GeoHash+Redis实现LBS附近地点搜索</a></p>
              <p class="item-date"><time datetime="2015-10-21T07:55:27.000Z" itemprop="datePublished">2015年10月21日</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/devops/">devops</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/geohash/">geohash</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/restful/">restful</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/互联网/">互联网+</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/API版本控制/">API版本控制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Martin-Fowler/">Martin Fowler</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Robert-C-Martin/">Robert C. Martin</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/artifactory/">artifactory</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/">devops</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geohash/">geohash</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lbs/">lbs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restful/">restful</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/互联网/">互联网+</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务/">微服务</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/API版本控制/" style="font-size: 10px;">API版本控制</a> <a href="/tags/Martin-Fowler/" style="font-size: 20px;">Martin Fowler</a> <a href="/tags/Robert-C-Martin/" style="font-size: 20px;">Robert C. Martin</a> <a href="/tags/artifactory/" style="font-size: 20px;">artifactory</a> <a href="/tags/devops/" style="font-size: 20px;">devops</a> <a href="/tags/geohash/" style="font-size: 10px;">geohash</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/lbs/" style="font-size: 10px;">lbs</a> <a href="/tags/restful/" style="font-size: 10px;">restful</a> <a href="/tags/互联网/" style="font-size: 10px;">互联网+</a> <a href="/tags/微服务/" style="font-size: 20px;">微服务</a> <a href="/tags/翻译/" style="font-size: 10px;">翻译</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 文浩<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="https://github.com/wenhao/hexo-theme-icarus">icarus</a>
    </div>
  </div>
</footer>
    

  <script>var duoshuoQuery = {short_name:"cdwenhao"};</script>
  <script src="http://static.duoshuo.com/embed.js"></script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
<script src="/js/menu-nav.js" type="text/javascript"></script>

  </div>
</body>
</html>